import "../pack/pack160.code" as pack160
import "utils/pack/nonStrictUnpack256.code" as unpack256
import "utils/pack/pack128.code" as pack128
import "./getAddress.code" as getAddress
import "hashes/sha256/512bitPadded.code" as sha256
import "./getPubKey.code" as getPubKey
import "ecc/babyjubjubParams.code" as babyjubjubParams

def getAddressHash(field[2] pubKey) -> (field[2]):
    a = unpack256(pubKey[0])
    b = unpack256(pubKey[1])
   
    field[256] lhs = a
    field[256] rhs = b
    
    field[256] r = sha256(lhs, rhs)
    
    res0 = pack128(r[..128])
    res1 = pack128(r[128..])

    return [res0, res1]

def test0() -> (field):
  field[10] params = babyjubjubParams()

  field sk = 282324394531085309677427018261283605967
  pubKey = getPubKey(sk, params)
  pubKey[0] == 16428010759205586867472988482989322887913386998767333377575271214214492029849
  pubKey[1] == 10294856525321117163575365002854542770173806930940502200808818268646648068933

  addressHash = getAddressHash([16428010759205586867472988482989322887913386998767333377575271214214492029849, 10294856525321117163575365002854542770173806930940502200808818268646648068933])
  addressHash[0] == 112013844430218426183302973190293787561
  addressHash[1] == 317408675092797082752623245096933152267 

  address = getAddress([16428010759205586867472988482989322887913386998767333377575271214214492029849, 10294856525321117163575365002854542770173806930940502200808818268646648068933])
  address == 1191251769601070949839067924746216299932050281995

  return 1

def test1() -> (field):
  field[10] params = babyjubjubParams()

  
  field sk = 108052918993077532758493688869544418659
  pubKey = getPubKey(sk, params)
  pubKey[0] == 9313415619687737619906974515273752874720254615447909615036333021092882443880
  pubKey[1] == 20752870837085786847382888518685960519623794986919242733793791049140598628202

  addressHash = getAddressHash([9313415619687737619906974515273752874720254615447909615036333021092882443880, 20752870837085786847382888518685960519623794986919242733793791049140598628202])
  addressHash[0] == 263574322435420443132878113668557661652
  addressHash[1] == 26151274264449855745358523089996224632 

  address = getAddress([9313415619687737619906974515273752874720254615447909615036333021092882443880, 20752870837085786847382888518685960519623794986919242733793791049140598628202])
  address == 98377457577610747965629472295276977026612074616
  
  return 1

def test2() -> (field):
  field[10] params = babyjubjubParams()

  field sk = 90165564446234840216644870892483492242
  pubKey = getPubKey(sk, params)
  pubKey[0] == 14533951413956604061133256706786686939352740496521595352490351551351119770794
  pubKey[1] == 13111598274536009943363897950577345811238370230693516717499279544006375710187

  addressHash = getAddressHash([14533951413956604061133256706786686939352740496521595352490351551351119770794, 13111598274536009943363897950577345811238370230693516717499279544006375710187])
  addressHash[0] == 109552730246946488367206181782314877369
  addressHash[1] == 77993395777404380459046375406321839738 

  address = getAddress([14533951413956604061133256706786686939352740496521595352490351551351119770794, 13111598274536009943363897950577345811238370230693516717499279544006375710187])
  address == 1195431596509751261413288945812563671344183291514
  
  return 1  

def main() -> (field):
 
    field r = test0()
    r = test1()
    r = test2()

  return 1
  